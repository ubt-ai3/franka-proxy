From 5ca1a015ca1280a4847a7d08761892a0053b8387 Mon Sep 17 00:00:00 2001
From: David Harrer <david.harrer@uni-bayreuth.de>
Date: Wed, 23 Sep 2020 17:12:54 +0200
Subject: [PATCH 4/4] fix_cmake_lists

---
 CMakeLists.txt | 121 +++----------------------------------------------
 1 file changed, 6 insertions(+), 115 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 866be7c..9cb8a8a 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -48,7 +48,7 @@ endif()
 add_subdirectory(common)
 
 ## Library
-add_library(franka SHARED
+add_library(franka STATIC
   src/control_loop.cpp
   src/control_tools.cpp
   src/control_types.cpp
@@ -103,7 +103,7 @@ target_include_directories(franka PUBLIC
 target_link_libraries(franka PRIVATE
   Poco::Foundation
   Poco::Net
-  Eigen3::Eigen3
+  Eigen3::Eigen
   Threads::Threads
   libfranka-common
 )
@@ -112,9 +112,10 @@ target_link_libraries(franka PRIVATE
 include(GNUInstallDirs)
 set(INSTALL_CMAKE_CONFIG_DIR ${CMAKE_INSTALL_LIBDIR}/cmake/Franka)
 
-install(TARGETS franka
+install(TARGETS franka libfranka-common
   EXPORT FrankaTargets
-  LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}
+  ARCHIVE DESTINATION ${CMAKE_INSTALL_LIBDIR}
+  #LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}
   RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR}
 )
 install(DIRECTORY include/ DESTINATION ${CMAKE_INSTALL_INCLUDEDIR})
@@ -141,114 +142,4 @@ install(FILES
 install(EXPORT FrankaTargets
   NAMESPACE Franka::
   DESTINATION ${INSTALL_CMAKE_CONFIG_DIR}
-)
-
-## Subprojects
-
-# Ignore find_package(Franka) in subprojects.
-macro(find_package)
-  if(NOT "${ARGV0}" STREQUAL Franka AND NOT DEFINED "${ARGV0}_FOUND")
-    _find_package(${ARGV})
-  endif()
-endmacro()
-
-option(BUILD_TESTS "Build tests" ON)
-if(BUILD_TESTS)
-  enable_testing()
-  add_subdirectory(test)
-endif()
-
-option(BUILD_EXAMPLES "Build example code" ON)
-if(BUILD_EXAMPLES)
-  add_subdirectory(examples)
-endif()
-
-option(BUILD_DOCUMENTATION "Build documentation" OFF)
-if(BUILD_DOCUMENTATION)
-  add_subdirectory(doc)
-endif()
-
-## Packaging
-set(CPACK_PACKAGE_VENDOR "Franka Emika GmbH")
-set(CPACK_GENERATOR "DEB;TGZ")
-set(CPACK_PACKAGE_VERSION ${libfranka_VERSION})
-set(CPACK_SYSTEM_NAME ${CMAKE_HOST_SYSTEM_PROCESSOR})
-
-# Debian
-find_program(DPKG_PROG dpkg DOC "'dpkg' executable")
-if(DPKG_PROG)
-  execute_process(COMMAND ${DPKG_PROG} --print-architecture
-    OUTPUT_VARIABLE CPACK_DEBIAN_PACKAGE_ARCHITECTURE
-    OUTPUT_STRIP_TRAILING_WHITESPACE
-  )
-  # Change system name to use the correct architecture in file name
-  set(CPACK_SYSTEM_NAME ${CPACK_DEBIAN_PACKAGE_ARCHITECTURE})
-endif()
-# Debian versions require a dash
-set(CPACK_DEBIAN_PACKAGE_VERSION ${CPACK_PACKAGE_VERSION}-1)
-set(CPACK_DEBIAN_PACKAGE_MAINTAINER "Franka Emika GmbH")
-set(CPACK_DEBIAN_PACKAGE_DEPENDS "libpoco-dev")
-set(CPACK_DEBIAN_PACKAGE_CONFLICTS "ros-kinetic-libfranka")
-
-include(CPack)
-
-## Tools
-file(GLOB_RECURSE SOURCES
-  src/*.cpp
-  examples/*.cpp
-  common/*.cpp
-)
-file(GLOB_RECURSE HEADERS
-  include/*.h
-  src/*.h
-  examples/*.h
-  common/*.h
-)
-file(GLOB_RECURSE TEST_FILES
-  test/*.h
-  test/*.cpp
-)
-file(GLOB_RECURSE TIDY_IGNORED_FILES
-  src/libfcimodels.h
-)
-
-find_program(CLANG_FORMAT_PROG clang-format-6.0 DOC "'clang-format' executable")
-if(CLANG_FORMAT_PROG)
-  add_custom_target(format
-    COMMAND ${CLANG_FORMAT_PROG} -i ${SOURCES} ${HEADERS} ${TEST_FILES}
-    WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
-    COMMENT "Formatting source code with clang-format"
-    VERBATIM
-  )
-  add_custom_target(check-format
-    COMMAND scripts/format-check.sh ${CLANG_FORMAT_PROG} -output-replacements-xml ${SOURCES} ${HEADERS} ${TEST_FILES}
-    WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
-    COMMENT "Checking code formatting with clang-format"
-    VERBATIM
-  )
-endif()
-find_program(CLANG_TIDY_PROG clang-tidy-6.0 DOC "'clang-tidy' executable")
-if(CLANG_TIDY_PROG)
-  # Build JSON string for clang-tidy's line filter
-  set(TIDY_FILES ${SOURCES} ${HEADERS})
-  foreach(ignored_file ${TIDY_IGNORED_FILES})
-    list(REMOVE_ITEM TIDY_FILES ${ignored_file})
-  endforeach()
-  string(REPLACE ";" "\"},{\"name\":\"" TIDY_LINE_FILTER "${TIDY_FILES}")
-  set(TIDY_LINE_FILTER "[{\"name\":\"${TIDY_LINE_FILTER}\"}]")
-
-  add_custom_target(tidy
-    COMMAND ${CLANG_TIDY_PROG} -p=${CMAKE_BINARY_DIR}
-                               -line-filter=${TIDY_LINE_FILTER} ${SOURCES}
-    WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
-    COMMENT "Running clang-tidy"
-    VERBATIM
-  )
-  add_custom_target(check-tidy
-    COMMAND scripts/fail-on-output.sh ${CLANG_TIDY_PROG} -p=${CMAKE_BINARY_DIR}
-                                      -line-filter=${TIDY_LINE_FILTER} ${SOURCES}
-    WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
-    COMMENT "Running clang-tidy"
-    VERBATIM
-  )
-endif()
+)
\ No newline at end of file
-- 
2.25.0.windows.1

